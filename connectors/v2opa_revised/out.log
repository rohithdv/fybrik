2021/07/05 17:08:12 Server started
2021/07/05 17:08:29 Received PolicymanagerRequest
2021/07/05 17:08:29 {0xc00011d2c0 {read 0xc000105f80} {{"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"} <nil> <nil>}}
2021/07/05 17:08:29 Env. variable extracted: CATALOG_CONNECTOR_URL - wkc-connector.m4d-system:50090
2021/07/05 17:08:29 Env. variable extracted: CONNECTION_TIMEOUT - 120
2021/07/05 17:08:29 Env. variable extracted: OPA_SERVER_URL - opa:8181
2021/07/05 17:08:29 Env. variable extracted: CATALOG_PROVIDER_NAME - WKC
2021/07/05 17:08:29 creds in GetDatasetsMetadataFromCatalog: http://vault.m4d-system:8200/v1/kubernetes-secrets/wkc-creds?namespace=cp4d
2021/07/05 17:08:29 Create new catalog connection using catalog connector address:  wkc-connector.m4d-system:50090
query77777
map[creds:[http://vault.m4d-system:8200/v1/kubernetes-secrets/wkc-creds?namespace=cp4d] input:[{"action":{"action_type":"read","processingLocation":"Netherlands"},"request_context":{"intent":"Fraud Detection","role":"Data Scientist"},"resource":{"name":"{\"asset_id\": \"0bb3245e-e3ef-40b7-b639-c471bae4966c\", \"catalog_id\": \"503d683f-1d43-4257-a1a3-0ddf5e446ba5\"}"}}]]
creds received
http://vault.m4d-system:8200/v1/kubernetes-secrets/wkc-creds?namespace=cp4d
HTTP Request Got
GET /getPoliciesDecisions?creds=http%3A%2F%2Fvault.m4d-system%3A8200%2Fv1%2Fkubernetes-secrets%2Fwkc-creds%3Fnamespace%3Dcp4d&input=%7B%22action%22%3A%7B%22action_type%22%3A%22read%22%2C%22processingLocation%22%3A%22Netherlands%22%7D%2C%22request_context%22%3A%7B%22intent%22%3A%22Fraud+Detection%22%2C%22role%22%3A%22Data+Scientist%22%7D%2C%22resource%22%3A%7B%22name%22%3A%22%7B%5C%22asset_id%5C%22%3A+%5C%220bb3245e-e3ef-40b7-b639-c471bae4966c%5C%22%2C+%5C%22catalog_id%5C%22%3A+%5C%22503d683f-1d43-4257-a1a3-0ddf5e446ba5%5C%22%7D%22%7D%7D HTTP/1.1
Host: v2opaconnector.m4d-system:50050
accept-encoding: gzip
user-agent: OpenAPI-Generator/1.0.0/go
accept: application/json
encodedValue
/getPoliciesDecisions?creds=http%3A%2F%2Fvault.m4d-system%3A8200%2Fv1%2Fkubernetes-secrets%2Fwkc-creds%3Fnamespace%3Dcp4d&input=%7B%22action%22%3A%7B%22action_type%22%3A%22read%22%2C%22processingLocation%22%3A%22Netherlands%22%7D%2C%22request_context%22%3A%7B%22intent%22%3A%22Fraud+Detection%22%2C%22role%22%3A%22Data+Scientist%22%7D%2C%22resource%22%3A%7B%22name%22%3A%22%7B%5C%22asset_id%5C%22%3A+%5C%220bb3245e-e3ef-40b7-b639-c471bae4966c%5C%22%2C+%5C%22catalog_id%5C%22%3A+%5C%22503d683f-1d43-4257-a1a3-0ddf5e446ba5%5C%22%7D%22%7D%7D
decodedValue
/getPoliciesDecisions?creds=http://vault.m4d-system:8200/v1/kubernetes-secrets/wkc-creds?namespace=cp4d&input={"action":{"action_type":"read","processingLocation":"Netherlands"},"request_context":{"intent":"Fraud Detection","role":"Data Scientist"},"resource":{"name":"{\"asset_id\": \"0bb3245e-e3ef-40b7-b639-c471bae4966c\", \"catalog_id\": \"503d683f-1d43-4257-a1a3-0ddf5e446ba5\"}"}}
formatRequest
GET /getPoliciesDecisions?creds=http%3A%2F%2Fvault.m4d-system%3A8200%2Fv1%2Fkubernetes-secrets%2Fwkc-creds%3Fnamespace%3Dcp4d&input=%7B%22action%22%3A%7B%22action_type%22%3A%22read%22%2C%22processingLocation%22%3A%22Netherlands%22%7D%2C%22request_context%22%3A%7B%22intent%22%3A%22Fraud+Detection%22%2C%22role%22%3A%22Data+Scientist%22%7D%2C%22resource%22%3A%7B%22name%22%3A%22%7B%5C%22asset_id%5C%22%3A+%5C%220bb3245e-e3ef-40b7-b639-c471bae4966c%5C%22%2C+%5C%22catalog_id%5C%22%3A+%5C%22503d683f-1d43-4257-a1a3-0ddf5e446ba5%5C%22%7D%22%7D%7D HTTP/1.1
Host: v2opaconnector.m4d-system:50050
user-agent: OpenAPI-Generator/1.0.0/go
accept: application/json
accept-encoding: gzip
inconstructPolicymanagerRequest
inputString
{"action":{"action_type":"read","processingLocation":"Netherlands"},"request_context":{"intent":"Fraud Detection","role":"Data Scientist"},"resource":{"name":"{\"asset_id\": \"0bb3245e-e3ef-40b7-b639-c471bae4966c\", \"catalog_id\": \"503d683f-1d43-4257-a1a3-0ddf5e446ba5\"}"}}
bird: %v {0xc00011d2c0 {read 0xc000105f80} {{"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"} <nil> <nil>}}
Reached Server!
input
{0xc00011d2c0 {read 0xc000105f80} {{"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"} <nil> <nil>}}
2021/07/05 17:08:33 Received Response from External Catalog Connector for  dataSetID: {"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"}
2021/07/05 17:08:33 Response received from External Catalog Connector is given below:
2021/07/05 17:08:33 {
	"dataset_id": "{\"asset_id\": \"0bb3245e-e3ef-40b7-b639-c471bae4966c\", \"catalog_id\": \"503d683f-1d43-4257-a1a3-0ddf5e446ba5\"}",
	"details": {
		"name": "NTNU asset",
		"data_owner": "1000331001",
		"data_store": {
			"type": 2,
			"name": "object store",
			"s3": {
				"endpoint": "s3.eu-gb.cloud-object-storage.appdomain.cloud",
				"bucket": "notebook-sample",
				"object_key": "data.csv"
			}
		},
		"data_format": "csv",
		"geo": "Turkey",
		"metadata": {
			"dataset_named_metadata": {
				"asset_attributes": "data_asset,asset_terms,data_profile,column_info",
				"asset_category": "USER",
				"asset_state": "available",
				"asset_type": "data_asset",
				"catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5",
				"created_at": "2021-05-04T12:33:50Z",
				"rating": "0.0",
				"total_rating": "0"
			},
			"dataset_tags": [
				"residency = Turkey"
			],
			"components_metadata": {
				"amount": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					},
					"tags": [
						"Confidential"
					]
				},
				"isFlaggedFraud": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"isFraud": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"nameDest": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"nameOrig": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"newbalanceDest": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"newbalanceOrig": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					},
					"tags": [
						"Confidential"
					]
				},
				"oldbalanceDest": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"oldbalanceOrg": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"step": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				},
				"type": {
					"component_type": "column",
					"named_metadata": {
						"type": "length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false"
					}
				}
			}
		},
		"credentials_info": {
			"vault_secret_path": "/v1/wkc-creds/s3creds/503d683f-1d43-4257-a1a3-0ddf5e446ba5?asset_id=0bb3245e-e3ef-40b7-b639-c471bae4966c"
		}
	}
}
2021/07/05 17:08:33 dataset_id {"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"}
2021/07/05 17:08:33 tagArr:  [residency = Turkey]
2021/07/05 17:08:33 in.GetResource().GetTags():  map[tags:map[residency:Turkey]]
2021/07/05 17:08:33 key : oldbalanceOrg
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : newbalanceOrig
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false] tags:[Confidential]]
2021/07/05 17:08:33 key : oldbalanceDest
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : isFraud
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : nameDest
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : nameOrig
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : newbalanceDest
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : step
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : type
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 key : amount
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false] tags:[Confidential]]
2021/07/05 17:08:33 key : isFlaggedFraud
2021/07/05 17:08:33 val : map[component_type:column named_metadata:map[type:length=1024.0,nullable=true,type=varchar,scale=0.0,signed=false]]
2021/07/05 17:08:33 ******** listofcols : ******* [oldbalanceOrg newbalanceOrig oldbalanceDest isFraud nameDest nameOrig newbalanceDest step type amount isFlaggedFraud]
2021/07/05 17:08:33 ******** listoftags: ******* [[] [Confidential] [] [] [] [] [] [] [] [Confidential] []]
2021/07/05 17:08:33 ******** cols : *******
2021/07/05 17:08:33 cols= [{oldbalanceOrg <nil>} {newbalanceOrig 0xc0002962b8} {oldbalanceDest <nil>} {isFraud <nil>} {nameDest <nil>} {nameOrig <nil>} {newbalanceDest <nil>} {step <nil>} {type <nil>} {amount 0xc0002962c0} {isFlaggedFraud <nil>}]
2021/07/05 17:08:33 cols= oldbalanceOrg
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 cols= newbalanceOrig
2021/07/05 17:08:33 cols= map[tags:map[Confidential:true]]
2021/07/05 17:08:33 cols= oldbalanceDest
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 cols= isFraud
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 cols= nameDest
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 cols= nameOrig
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 cols= newbalanceDest
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 cols= step
2021/07/05 17:08:33 cols= map[]
stringified policy manager request {"action":{"action_type":"read","processingLocation":"Netherlands"},"request_context":{"intent":"Fraud Detection","role":"Data Scientist"},"resource":{"columns":[{"name":"oldbalanceOrg"},{"name":"newbalanceOrig","tags":{"tags":{"Confidential":"true"}}},{"name":"oldbalanceDest"},{"name":"isFraud"},{"name":"nameDest"},{"name":"nameOrig"},{"name":"newbalanceDest"},{"name":"step"},{"name":"type"},{"name":"amount","tags":{"tags":{"Confidential":"true"}}},{"name":"isFlaggedFraud"}],"name":"{\"asset_id\": \"0bb3245e-e3ef-40b7-b639-c471bae4966c\", \"catalog_id\": \"503d683f-1d43-4257-a1a3-0ddf5e446ba5\"}","tags":{"tags":{"residency":"Turkey"}}}}
updated stringified policy manager request iun GetOPADecisions { "input": {"action":{"action_type":"read","processingLocation":"Netherlands"},"request_context":{"intent":"Fraud Detection","role":"Data Scientist"},"resource":{"columns":[{"name":"oldbalanceOrg"},{"name":"newbalanceOrig","tags":{"tags":{"Confidential":"true"}}},{"name":"oldbalanceDest"},{"name":"isFraud"},{"name":"nameDest"},{"name":"nameOrig"},{"name":"newbalanceDest"},{"name":"step"},{"name":"type"},{"name":"amount","tags":{"tags":{"Confidential":"true"}}},{"name":"isFlaggedFraud"}],"name":"{\"asset_id\": \"0bb3245e-e3ef-40b7-b639-c471bae4966c\", \"catalog_id\": \"503d683f-1d43-4257-a1a3-0ddf5e446ba5\"}","tags":{"tags":{"residency":"Turkey"}}}} }
2021/07/05 17:08:33 cols= type
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 cols= amount
2021/07/05 17:08:33 cols= map[tags:map[Confidential:true]]
2021/07/05 17:08:33 cols= isFlaggedFraud
2021/07/05 17:08:33 cols= map[]
2021/07/05 17:08:33 ******** in before: ******* {0xc00011d2c0 {read 0xc000105f80} {{"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"} 0xc0002962b0 <nil>}}
2021/07/05 17:08:33 ******** res before: ******* {{"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"} 0xc0002962b0 <nil>}
2021/07/05 17:08:33 ******** res after: ******* {{"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"} 0xc0002962b0 0xc0003bed60}
2021/07/05 17:08:33 ******** in after: ******* {0xc00011d2c0 {read 0xc000105f80} {{"asset_id": "0bb3245e-e3ef-40b7-b639-c471bae4966c", "catalog_id": "503d683f-1d43-4257-a1a3-0ddf5e446ba5"} 0xc0002962b0 0xc0003bed60}}
2021/07/05 17:08:33 ******** udpated policy manager resp object : *******
2021/07/05 17:08:33 ******** udpated policy manager resp object end : *******
2021/07/05 17:08:33 using opaServerURL in OPAConnector EvaluatePoliciesOnInput:  http://opa:8181/
2021/07/05 17:08:33 inputJSON in pretty print 
2021/07/05 17:08:33 res =  {
  "input": {
    "action": {
      "action_type": "read",
      "processingLocation": "Netherlands"
    },
    "request_context": {
      "intent": "Fraud Detection",
      "role": "Data Scientist"
    },
    "resource": {
      "columns": [
        {
          "name": "oldbalanceOrg"
        },
        {
          "name": "newbalanceOrig",
          "tags": {
            "tags": {
              "Confidential": "true"
            }
          }
        },
        {
          "name": "oldbalanceDest"
        },
        {
          "name": "isFraud"
        },
        {
          "name": "nameDest"
        },
        {
          "name": "nameOrig"
        },
        {
          "name": "newbalanceDest"
        },
        {
          "name": "step"
        },
        {
          "name": "type"
        },
        {
          "name": "amount",
          "tags": {
            "tags": {
              "Confidential": "true"
            }
          }
        },
        {
          "name": "isFlaggedFraud"
        }
      ],
      "name": "{\"asset_id\": \"0bb3245e-e3ef-40b7-b639-c471bae4966c\", \"catalog_id\": \"503d683f-1d43-4257-a1a3-0ddf5e446ba5\"}",
      "tags": {
        "tags": {
          "residency": "Turkey"
        }
      }
    }
  }
}

2021/07/05 17:08:33 opaServerURL
2021/07/05 17:08:33 http://opa:8181/
2021/07/05 17:08:33 req in OPAConnector performHTTPReq:  &{POST http://opa:8181/v1/data/dataapi/authz  0 0 map[Content-Type:[application/json; charset=UTF-8]] {0xc0003bf760} <nil> 0 [] false  map[] map[] <nil> map[]   <nil> <nil> <nil> <nil>}
2021/07/05 17:08:33 httpMethod in OPAConnector performHTTPReq:  POST
2021/07/05 17:08:33 reqURL in OPAConnector performHTTPReq:  http://opa:8181/v1/data/dataapi/authz
2021/07/05 17:08:33 reqBody in OPAConnector performHTTPReq:  {0xc0003bf760}
2021/07/05 17:08:33 POST succeeded
2021/07/05 17:08:33 body from input http response: {"decision_id":"969093e1-0853-4b99-bab7-7b44ed8bf0be","result":{"transform":[{"action":{"columns":["newbalanceOrig","amount"],"name":"RedactColumn"},"policy":"Columns with Confidential tag to be redacted before read action"}]}}
2021/07/05 17:08:33 status from input http response: 200
2021/07/05 17:08:33 responsestring data
2021/07/05 17:08:33 {"decision_id":"969093e1-0853-4b99-bab7-7b44ed8bf0be","result":{"transform":[{"action":{"columns":["newbalanceOrig","amount"],"name":"RedactColumn"},"policy":"Columns with Confidential tag to be redacted before read action"}]}}
2021/07/05 17:08:33 decision_id: 969093e1-0853-4b99-bab7-7b44ed8bf0be
2021/07/05 17:08:33 result: {"transform":[{"action":{"columns":["newbalanceOrig","amount"],"name":"RedactColumn"},"policy":"Columns with Confidential tag to be redacted before read action"}]}
2021/07/05 17:08:33 OPA Eval : {"decision_id":"969093e1-0853-4b99-bab7-7b44ed8bf0be","result":{"transform":[{"action":{"columns":["newbalanceOrig","amount"],"name":"RedactColumn"},"policy":"Columns with Confidential tag to be redacted before read action"}]}}
2021/07/05 17:08:33 transformAction map[action:map[columns:[newbalanceOrig amount] name:RedactColumn] policy:Columns with Confidential tag to be redacted before read action]
2021/07/05 17:08:33 transformAction type : map[string]interface {}
2021/07/05 17:08:33 result1["action"].(string) : map[columns:[newbalanceOrig amount] name:RedactColumn]
2021/07/05 17:08:33 Name: RedactColumn
2021/07/05 17:08:33 resCols [newbalanceOrig amount]
2021/07/05 17:08:33 lstOfCols [newbalanceOrig amount]
2021/07/05 17:08:33 lstTransformations[i] map[action:map[columns:[newbalanceOrig amount] name:RedactColumn] policy:Columns with Confidential tag to be redacted before read action]
2021/07/05 17:08:33 result1 type in ConvertOpaResponseToPolicymanagerResponse transform part  map[string]interface {}
2021/07/05 17:08:33 *policyManagerResp:  {<nil> [{{0xc00011da80 <nil>} Columns with Confidential tag to be redacted before read action}]}
2021/07/05 17:08:33 policyManagerResponse :  {<nil> [{{0xc00011da80 <nil>} Columns with Confidential tag to be redacted before read action}]}
2021/07/05 17:08:33 Received evaluation : {
	"result": [
		{
			"action": {
				"columns": [
					"newbalanceOrig",
					"amount"
				],
				"name": "RedactColumn"
			},
			"policy": "Columns with Confidential tag to be redacted before read action"
		}
	]
}
2021/07/05 17:08:33 implResp evaluation :  {200 {<nil> [{{0xc00011da80 <nil>} Columns with Confidential tag to be redacted before read action}]}}
2021/07/05 17:08:33 GET /getPoliciesDecisions?creds=http%3A%2F%2Fvault.m4d-system%3A8200%2Fv1%2Fkubernetes-secrets%2Fwkc-creds%3Fnamespace%3Dcp4d&input=%7B%22action%22%3A%7B%22action_type%22%3A%22read%22%2C%22processingLocation%22%3A%22Netherlands%22%7D%2C%22request_context%22%3A%7B%22intent%22%3A%22Fraud+Detection%22%2C%22role%22%3A%22Data+Scientist%22%7D%2C%22resource%22%3A%7B%22name%22%3A%22%7B%5C%22asset_id%5C%22%3A+%5C%220bb3245e-e3ef-40b7-b639-c471bae4966c%5C%22%2C+%5C%22catalog_id%5C%22%3A+%5C%22503d683f-1d43-4257-a1a3-0ddf5e446ba5%5C%22%7D%22%7D%7D GetPoliciesDecisions 3.609856991s
